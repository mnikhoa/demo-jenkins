---
- hosts: Webserver
  remote_user: ubuntu
  become: yes
  tasks:
    # - name: Update all packages to the latest version
    #   apt:
    #     upgrade: dist
    # - name: Install Docker
    #   package:
    #     name:
    #       - docker-ce
    #       - docker-ce-cli
    #       - containerd
    #       - docker-buildx
    #       - docker-compose
    #     state: present
    - name: Install Docker on Webserver
      shell: |
          #!bin/bash
          sudo -s
          sudo apt-get update
          sudo apt-get install -y \
              ca-certificates
              curl \
              gnupg \
              lsb-release &&
          sudo mkdir -m 0755 -p /etc/apt/keyrings
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg &&
          echo \
            "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
            $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null &&
          sudo apt-get update
          sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    - name: Login DockerHub
      # shell: docker login -u "{{DOCKER_USERNAME}}" -p "{{DOCKER_PASSWORD}}"
      shell: |
          apt update && apt-get update
          apt install dbus-x11 -y
          apt install gnome-keyring -y
          apt install gnupg2 pass -y
          echo "{{DOCKER_PASSWORD}}" | docker login --username "{{DOCKER_USERNAME}}" --password-stdin
    - name: Copy file
      copy:
        src: docker-compose.yaml
        dest: /home/ubuntu/
    - name: Restart docker-compose
      shell: |
          docker-compose stop
          docker-compose rm -f
          docker-compose pull
          docker-compose up -d
...
